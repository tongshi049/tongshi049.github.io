<!DOCTYPE HTML>
<html lang="null">


<head><meta name="generator" content="Hexo 3.8.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="TODO List Project - Spring Security, TongTong Shi&#39;s Blog">
    <meta name="description" content="previous_step

Implementing Basic Authentication with Spring Boot and Spring Security1. Overview of Security with Basic ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TODO List Project - Spring Security | TongTong Shi&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>

<!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">TongTong Shi's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/" class="waves-effect waves-light">
						
						<i class="fa fa-home"></i>
						
						<span>Index</span>
					</a>
          
        </li>
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/tags" class="waves-effect waves-light">
						
						<i class="fa fa-tags"></i>
						
						<span>Tags</span>
					</a>
          
        </li>
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/about" class="waves-effect waves-light">
						
						<i class="fa fa-user-circle-o"></i>
						
						<span>About</span>
					</a>
          
        </li>
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/contact" class="waves-effect waves-light">
						
						<i class="fa fa-comments"></i>
						
						<span>Contact</span>
					</a>
          
        </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">TongTong Shi's Blog</div>
        <div class="logo-desc">
            
            A Playground to Share My Knowledge
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-user-circle-o"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        TODO List Project - Spring Security
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Project/" target="_blank">
                                <span class="chip bg-color">Project</span>
                            </a>
                        
                            <a href="/tags/Angular/" target="_blank">
                                <span class="chip bg-color">Angular</span>
                            </a>
                        
                            <a href="/tags/Spring-Boot/" target="_blank">
                                <span class="chip bg-color">Spring Boot</span>
                            </a>
                        
                            <a href="/tags/Spring-Security/" target="_blank">
                                <span class="chip bg-color">Spring Security</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2019-06-10
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>Word Count:&nbsp;&nbsp;
                        1.9k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>Read Times:&nbsp;&nbsp;
                        12 Min
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <a href="/2019/06/08/todo-backendIII/" title="previous_step">previous_step</a>

<h2 id="Implementing-Basic-Authentication-with-Spring-Boot-and-Spring-Security"><a href="#Implementing-Basic-Authentication-with-Spring-Boot-and-Spring-Security" class="headerlink" title="Implementing Basic Authentication with Spring Boot and Spring Security"></a>Implementing Basic Authentication with Spring Boot and Spring Security</h2><p><font color="dodgerblue"><strong>1. Overview of Security with Basic Auth and JWT</strong></font></p>
<p>Next, we will implement a basic approach called <strong>basic authentication</strong>, there along with every request you’d need to send a user and password. So if I have to agree to this request, I would need to send in a user id and password. We will also discuss the fact that sending a user id and password with every request is not safe becaue if somebody gets the id and password then they can do everything with it. And that’s where we create a temporary token call <strong>JWT</strong>, i.e. JSON Web Token, and we will discuss about what is the difference between <strong>basic security</strong> and <strong>JWT</strong>, and how <strong>JWT</strong> is more secure. We enhance our services with authentication, and have front end application connect to it.</p>
<a id="more"></a>

<p><font color="dodgerblue"><strong>2. Setting Up Spring Security</strong></font></p>
<p>The easiest way you can make something secure is adding a very simple dependency, <code>spring-boot-starter-security</code>. It is the spring boot starter for implementing security in web applications, as well as RESTful services.</p>
<p>Now, when visiting <code>http://localhost:8080/*</code>, it is taking us to log in page. There is a <code>form</code> in the login page. That’s why, this is called a form based authentication. The default username is <em>user</em>, and the default password is printed on the console. After inputing username and password, we can execute any number of other requests.<font color="purple"> So once you enter the user id and password with form based authenticcation, a <strong>session cookie</strong> is set. So there is a <strong>session</strong> for you which is created on the <strong>server side</strong>, and a <strong>cookie</strong> is now registered in <strong>your browser</strong>, and that <strong>cookie</strong> is sent along with every request.</font></p>
<p><font color="dodgerblue"><strong>3. Configuring Standard UserId and Password</strong></font></p>
<p>We can set the username and password in <code>application.properties</code>.</p>
<pre><code>spring.security.user.name=user
spring.security.user.password=password</code></pre>

<p><font color="dodgerblue"><strong>4. Enhancing Angular Welcome Data Service to use Basic Auth</strong></font></p>
<p>Now, if we click the button <code>Get Welcome Message</code>, we may encouter an errer. That is <font color="red"><code>Access to XMLHttpRequest at &#39;http://localhost:8080/hello-world-bean/path-variable/teemo&#39; from origin &#39;http://localhost:4200&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.</code></font> To solve it, we need to add authentication in the <code>header</code>.</p>
<pre><code>&#x2F;&#x2F; http:&#x2F;&#x2F;localhost:8080&#x2F;hello-world-bean&#x2F;path-variable&#x2F;teemo
executeHelloWorldServiceWithPathVariable(name) {
&#x2F;&#x2F;console.log(&quot;Execute Hello World Bean Service&quot;);
  let basicAuthHeaderString = this.createBasicAuthenticationHttpHeader();

  let headers = new HttpHeaders({ Authorization: basicAuthHeaderString })

  return this.http.get&lt;HelloWorldBean&gt;(`http:&#x2F;&#x2F;localhost:8080&#x2F;hello-world-bean&#x2F;path-variable&#x2F;${name}`, {headers: headers});
}

createBasicAuthenticationHttpHeader() {
  let username = &#39;teemo&#39;;
  let password = &#39;233&#39;;
  let basicAuthHeaderString = &#39;Basic&#39; + window.btoa(username + &#39;:&#39; + password);
  return basicAuthHeaderString;
}</code></pre>

<p>Now the error messsage bocomes <font color="red"><code>Access to XMLHttpRequest at &#39;http://localhost:8080/hello-world-bean/path-variable/teemo&#39; from origin &#39;http://localhost:4200&#39; has been blocked by CORS policy: Response to preflight request doesn&#39;t pass access control check: It does not have HTTP ok status.</code></font> When we check the <em>network</em>, we can see there is a new request which is being sent. Let’s look at the General. There is a new request method which is being used. It is <em>OPTIONS</em>.<br><img src="options.png" height="60%" width="60%"></p>
<p>What is happending is as soon as we added basic authentication some kind of authentication to our request. Before making the http call, there is something called <code>options check</code> which is done and you can see that this <code>options check</code> is failing. We will fix it in the next step, along with something called <strong>CSRM</strong>.</p>
<p><font color="dodgerblue"><strong>5. Configuring Spring Security to Disable CSRF and Enable <em>OPTION</em> Requests</strong></font></p>
<p>What happens is whenever we add authorization credentials on a <em>GET</em> request, or a <em>POST</em> request, what happens is a <em>preflight</em> request. So before sending the complete request, what happens is a request called <em>options</em> request is sent to check if you have the right permitions.<br>And what is happening is that <em>options</em> request is being denied right now. Next, we will fix it.<br>The other think will be working on this specific step, is something called <strong>CSRF</strong>, i.e. cross-site request format.</p>
<ul>
<li>Find the method <code>configure()</code> in class <code>WebSecurityConfigurerAdapter</code> and override it to solve the problem with <em>options</em>, as well as to disable something calle <strong>CSRF</strong>.<ul>
<li><code>.csrf().disable()</code> : disable CSRF</li>
<li><code>.antMatchers(HttpMethod.OPTIONS, &quot;/**&quot;).permitAll()</code> :  except for <em>options</em> request to all URLS</li>
<li><code>.anyRequest().authenticated()</code> : authenticate all the requests</li>
<li><code>.httpBasic()</code> : use basic authentication</li>
</ul>
</li>
</ul>
<p>The code is shown as follows.</p>
<pre><code>package com.example.todoList.basic.auth;

import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.annotation.web.configurers.ExpressionUrlAuthorizationConfigurer;

@Configuration
@EnableWebSecurity
public class SpringSecurityConfigurationBasicAuth extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {

    http
	  .csrf().disable()
	  .authorizeRequests()
	  .antMatchers(HttpMethod.OPTIONS, &quot;&#x2F;**&quot;).permitAll()
	  .anyRequest().authenticated()
	  .and()&#x2F;&#x2F;.formLogin().and()
	  .httpBasic();
  }
}</code></pre>

<p><strong>Ensure that this call should be in the same or subclass of the <code>TodoListApplication()</code>.</strong></p>
<p><font color="dodgerblue"><strong>6. Creating Angular HttpInterceptor to Add Basic Auth Header</strong></font></p>
<p>Now, we can successfully call the <code>HelloWorldBean</code> request. But other requests are not valid. To solve this, one option is adding the above <code>authentication header</code> in every http request. Absolutely this is not efficient.<br><font color="purple">Then we can use <em>HttpInterceptor</em>. The interceptors would enable us to add any request header to every request.</font></p>
<ul>
<li>Create a service <code>HttpInterceptor</code>. <code>ng generate service service/http/HttpIntercepterBasicAuth</code></li>
<li>Let <code>HttpIntercepterBasicAuthService</code> implements<code>HttpInterceptor</code> and override method <code>intercept(request: HttpRequest&lt;any&gt;, next: HttpHandler)</code>.<ul>
<li>clone the request.</li>
<li>add authorization header.</li>
<li>send the modified request to the next HTTP handler.</li>
</ul>
</li>
</ul>
<p>The code is shown as follows.</p>
<pre><code>export class HttpIntercepterBasicAuthService implements HttpInterceptor {

  constructor(

  ) { }

  intercept(request: HttpRequest&lt;any&gt;, next: HttpHandler) {
    let username = &#39;teemo&#39;;
    let password = &#39;233&#39;;
    let basicAuthHeaderString = &#39;Basic &#39; + window.btoa(username + &#39;:&#39; + password);

    request = request.clone({
      setHeaders: {
        Authorization: basicAuthHeaderString
      }
    })

    return next.handle(request);
  }
}</code></pre>

<p><font color="dodgerblue"><strong>7. Configure HttpInterceptor as Provider in App Module</strong></font></p>
<p>Next, we configure <em>HttpInterceptor</em> to be used in our module. Where is that module? <code>app.module.ts</code>. In here we have to confinure a provider for <em>HttpInterceptor</em>. We can do it like this,</p>
<pre><code>providers: [
  { provide: HTTP_INTERCEPTORS, useClass: HttpIntercepterBasicAuthService, multi: true }
],</code></pre>

<p>Now, all requests related to Todo Service work.</p>
<p><font color="dodgerblue"><strong>8. Create Basic Authentication RESTful Service in Spring Boot</strong></font></p>
<p>The problem is the login page is still using hard-coded authentication. Now we’ll create a service in the backend. The idea behind that is when the user is trying to login, we try to hit the service, and if the service returns validate response, then that means the user is authenticated. Otherwise the user is not really authenticated. </p>
<p>We create a controller <code>AuthenticationController</code>.</p>
<pre><code>@CrossOrigin(origins = &quot;http:&#x2F;&#x2F;localhost:4200&quot;)
@RestController
public class AuthenticationController {
  &#x2F;&#x2F; GET
  @GetMapping(path = &quot;&#x2F;basicauth&quot;)
  public AuthenticationBean authBean() {
      return new AuthenticationBean(&quot;You are authenticated.&quot;);
  }
}</code></pre>

<p><font color="dodgerblue"><strong>9. Create Angular Basic Authentication Service</strong></font></p>
<p>We want to call the above RESTful service in our <code>LoginComponent</code>. First, let’s code <code>basic-authentication.service.ts</code>.</p>
<ul>
<li><code>.pipe()</code> : if the http request is successful, then do the things in pipe as well. In <code>pipe()</code>, we can define, if there is a proper response coming back, then <code>map</code> it.</li>
<li>An important thing about doing stuff when you are working on the observer is to <strong>return the data back</strong>. Because the observable is executed only when somebody subscribes to it. And they would want to see the data.</li>
</ul>
<details>
<summary>CLICK ME</summary>

<pre><code>import { Injectable } from &#39;@angular&#x2F;core&#39;;
import { HttpHeaders, HttpClient } from &#39;@angular&#x2F;common&#x2F;http&#39;;
import { map } from &#39;rxjs&#x2F;operators&#39;;

@Injectable({
  providedIn: &#39;root&#39;
})

export class BasicAuthenticationService {

  constructor(
    private http: HttpClient
  ) { }

  authenticate(username, password) {
    if (username === &#39;teemo&#39; &amp;&amp; password === &#39;233&#39;) {
      sessionStorage.setItem(&#39;authenticaterUser&#39;, username);
      return true;
    }

    return false;
  }

  executeAuthenticationService(username, password) {
    let basicAuthHeaderString = &#39;Basic &#39; + window.btoa(username + &#39;:&#39; + password);

    let headers = new HttpHeaders({
      Authorization: basicAuthHeaderString
    })

    return this.http.get&lt;AuthenticationBean&gt;(
      `http:&#x2F;&#x2F;localhost:8080&#x2F;basicauth`, 
      {headers: headers}).pipe(
        map(
          data =&gt; {
            sessionStorage.setItem(&#39;authenticaterUser&#39;, username);
            return data;
          }
        )
      );
  }

  isUserLoggedIn() {
    let user = sessionStorage.getItem(&#39;authenticaterUser&#39;)
    return !(user === null)
  }

  logout() {
    sessionStorage.removeItem(&#39;authenticaterUser&#39;);
  }

}

export class AuthenticationBean {
  constructor(public message: string) {}
}
</code></pre>

</details>


<p><font color="dodgerblue"><strong>10. Connecting Login Page to Basic Authentication Service</strong></font></p>
<p>In <code>login.component.ts</code>, add method <code>handleBasicAuthLogin()</code>.</p>
<pre><code>handleBasicAuthLogin() {
  this.basicAuthenticationService
    .executeAuthenticationService(this.username, this.password)
    .subscribe(
      data =&gt; {
        console.log(data);
        this.router.navigate([&#39;welcome&#39;, this.username])
        this.invalidLogin = false;
      },
      error =&gt; {
        console.log(error)
        this.invalidLogin = true;
      }
    )
}</code></pre>

<p>In the next few steps, we refactor our code in Angular Frontend to eliminate hard-code.</p>
<p><font color="dodgerblue"><strong>11. Refactoring Angular Basic Authentication Service</strong></font></p>
<details>
<summary>CLICK ME</summary>

<pre><code>import { Injectable } from &#39;@angular&#x2F;core&#39;;
import { HttpHeaders, HttpClient } from &#39;@angular&#x2F;common&#x2F;http&#39;;
import { map } from &#39;rxjs&#x2F;operators&#39;;

@Injectable({
  providedIn: &#39;root&#39;
})
export class BasicAuthenticationService {

  constructor(
    private http: HttpClient
  ) { }

  executeAuthenticationService(username, password) {
    
    let basicAuthHeaderString = &#39;Basic &#39; + window.btoa(username + &#39;:&#39; + password);

    let headers = new HttpHeaders({
      Authorization: basicAuthHeaderString
    })

    return this.http.get&lt;AuthenticationBean&gt;(
      `http:&#x2F;&#x2F;localhost:8080&#x2F;basicauth`, 
      {headers: headers}).pipe(
        map(
          data =&gt; {
            sessionStorage.setItem(&#39;authenticaterUser&#39;, username);
            sessionStorage.setItem(&#39;token&#39;, basicAuthHeaderString);

            return data;
          }
        )
      );
  }

  getAuthenticatedUser() {
    return sessionStorage.getItem(&#39;authenticaterUser&#39;);
  }

  getAuthenticatedToken() {
    if (this.getAuthenticatedUser())
      return sessionStorage.getItem(&#39;token&#39;);
  }

  isUserLoggedIn() {
    let user = sessionStorage.getItem(&#39;authenticaterUser&#39;)
    return !(user === null)
  }

  logout() {
    sessionStorage.removeItem(&#39;authenticaterUser&#39;);
    sessionStorage.removeItem(&#39;token&#39;);
  }

}

export class AuthenticationBean {
  constructor(public message: string) {}
}
</code></pre>

</details>


<p><font color="dodgerblue"><strong>12. Refactoring HttpInterceptor to use Basic Authentication Token</strong></font></p>
<p>Remove the hard-coded part, get the <code>token</code> and <code>username</code> from <code>session</code>.</p>
<details>
<summary>CLICK ME</summary>

<pre><code>constructor(
  private basicAuthenticationService: BasicAuthenticationService
) { }

intercept(request: HttpRequest&lt;any&gt;, next: HttpHandler) {
  &#x2F;&#x2F; let username = &#39;teemo&#39;;
  &#x2F;&#x2F; let password = &#39;233&#39;;
  &#x2F;&#x2F;let basicAuthHeaderString = &#39;Basic &#39; + window.btoa(username + &#39;:&#39; + password);

  let basicAuthHeaderString = this.basicAuthenticationService.getAuthenticatedToken();
  let username = this.basicAuthenticationService.getAuthenticatedUser();

  if (basicAuthHeaderString &amp;&amp; username) {
    request = request.clone({
      setHeaders: {
        Authorization: basicAuthHeaderString
      }
    })
  }

  return next.handle(request);
}</code></pre>

</details>

<p><font color="dodgerblue"><strong>13. Best Practice - Use Constants for URLs and Tokens</strong></font></p>
<p>Up till new we hard coded the URL of the services, i.e. <code>http://localhost:8080/</code>. One of the important thing is, as we change from one environment to another environment, this stuff can change. That’s the reason why we would actually want to create constants for this stuff.</p>
<p>Next, we will create a file <code>app.contants.ts</code> under folder <code>app</code>.</p>
<pre><code>export const API_URL = &quot;http:&#x2F;&#x2F;localhost:8080&quot;</code></pre>

<p>We can also use const in <code>basic-authentication.service.ts</code>. That is,</p>
<pre><code>export const TOKEN = &#39;token&#39;;
export const AUTHENTICATED_USER = &#39;authenticaterUser&#39;;</code></pre>

<p><strong>Note that the above export const must be added above the <code>@Injectable({ providedIn: &#39;root&#39;})</code></strong></p>
<p><font color="tomato">So when we find ourselves using the same kind of constants, same kind of values multiple times, we can use a <em>constants</em> to present the value, and use it across the place. And <code>app.constants.ts</code> could be the single most place where we would put all the variables and when you’re building something for a different environment you can replace it with the specific value for a specific use, and be done with it.</font></p>
<a href="/2019/06/11/todo-security-JWT/" title="next_step">next_step</a>



            </div>
            <hr>

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>Reprint policy</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
                    <img alt style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png">
                </a>
            </div>
            <br>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">
                    《TODO List Project - Spring Security》
                </span> by
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2019/06/10/todo-authentication/" property="cc:attributionName" rel="cc:attributionURL">
                Tong Shi
            </a> is licensed under a
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
                Creative Commons Attribution 4.0 International License
            </a> 
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2019/06/11/todo-security-JWT/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="TODO List Project - JWT">
                        
                        <span class="card-title">TODO List Project - JWT</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            previous_step

Connecting Spring Security and Spring Boot with JWT1. Introduction to JWT
Basic authentication
As part of
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-06-11
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-user fa-fw"></i>
                            Tong Shi
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Project/" target="_blank">
                        <span class="chip bg-color">Project</span>
                    </a>
                    
                    <a href="/tags/Angular/" target="_blank">
                        <span class="chip bg-color">Angular</span>
                    </a>
                    
                    <a href="/tags/Spring-Boot/" target="_blank">
                        <span class="chip bg-color">Spring Boot</span>
                    </a>
                    
                    <a href="/tags/Spring-Security/" target="_blank">
                        <span class="chip bg-color">Spring Security</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2019/06/08/todo-backendIII/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="TODO List Project - Backend Part IV">
                        
                        <span class="card-title">TODO List Project - Backend Part IV</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            previous_step

Connecting Angular Frontend to Spring Boot Restful Services 2 - Designing RESTful Services for Todo Resou
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-06-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-user fa-fw"></i>
                            Tong Shi
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Project/" target="_blank">
                        <span class="chip bg-color">Project</span>
                    </a>
                    
                    <a href="/tags/Angular/" target="_blank">
                        <span class="chip bg-color">Angular</span>
                    </a>
                    
                    <a href="/tags/Spring-Boot/" target="_blank">
                        <span class="chip bg-color">Spring Boot</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Tong Shi&nbsp;@
            <a href="https://hexo.io/" target="_blank">Hexo</a>&nbsp;
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>&nbsp;
            <br>
            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;Total Words:&nbsp;<span class="white-color">167k</span>&nbsp;
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="fa fa-eye"></i>&nbsp;Total visits:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fa fa-users"></i>&nbsp;Total visitors:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;
            </span>
            
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/tongshi049" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:tshi3@ualberta.ca" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword" class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140095224-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-140095224-1');
</script>



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>