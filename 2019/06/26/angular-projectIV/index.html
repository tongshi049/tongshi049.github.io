<!DOCTYPE HTML>
<html lang="null">


<head><meta name="generator" content="Hexo 3.8.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="Project - Groupbuy App Part IV, TongTong Shi&#39;s Blog">
    <meta name="description" content="prev
Angular Basics II - Content Projection &amp;amp; Router &amp;amp; Pipe &amp;amp; ValidationComponent nesting is inevitable. For">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Project - Groupbuy App Part IV | TongTong Shi&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>

<!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">TongTong Shi's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/" class="waves-effect waves-light">
						
						<i class="fa fa-home"></i>
						
						<span>Index</span>
					</a>
          
        </li>
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/tags" class="waves-effect waves-light">
						
						<i class="fa fa-tags"></i>
						
						<span>Tags</span>
					</a>
          
        </li>
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/about" class="waves-effect waves-light">
						
						<i class="fa fa-user-circle-o"></i>
						
						<span>About</span>
					</a>
          
        </li>
    
	<li class="hide-on-med-and-down nav-item">
		
					  <a href="/contact" class="waves-effect waves-light">
						
						<i class="fa fa-comments"></i>
						
						<span>Contact</span>
					</a>
          
        </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">TongTong Shi's Blog</div>
        <div class="logo-desc">
            
            A Playground to Share My Knowledge
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-user-circle-o"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa fa-fw fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Project - Groupbuy App Part IV
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Project/" target="_blank">
                                <span class="chip bg-color">Project</span>
                            </a>
                        
                            <a href="/tags/Angular/" target="_blank">
                                <span class="chip bg-color">Angular</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2019-06-26
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>Word Count:&nbsp;&nbsp;
                        1.7k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>Read Times:&nbsp;&nbsp;
                        10 Min
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <a href="/2019/06/25/angular-projectIII/" title="prev">prev</a>
<h3 id="Angular-Basics-II-Content-Projection-amp-Router-amp-Pipe-amp-Validation"><a href="#Angular-Basics-II-Content-Projection-amp-Router-amp-Pipe-amp-Validation" class="headerlink" title="Angular Basics II - Content Projection &amp; Router &amp; Pipe &amp; Validation"></a>Angular Basics II - Content Projection &amp; Router &amp; Pipe &amp; Validation</h3><p><em>Component nesting</em> is inevitable. For example, previously we added <code>ImageSlider</code> (<code>&lt;app-image-slider&gt;</code>,<code>ScrollableTab</code>(<code>&lt;app-scrollable-tab&gt;</code>) components in <code>App</code> component (<code>app.component.html</code>). We can use <code>@Input()</code> and <code>@Output</code> to realize the data transfer between nesting components or between components and outside world. However, over nesting can lead to complexity and redundancy in our codes. To avoid the redundant data and events brought by component nesting, we can use <em>content projetion</em>, <em>router</em>, <em>directive</em> and <em>service</em>.</p>
<a id="more"></a>

<h4 id="1-Content-Projection"><a href="#1-Content-Projection" class="headerlink" title="1. Content Projection"></a><font color="dodgerblue">1. Content Projection</font></h4><p>Using <code>ng-content</code> to realize content projection. </p>
<ul>
<li>what: dynamic content</li>
<li>syntax: <code>&lt;ng-content select=&quot;style classes / HTML tags / directives&quot;&gt;&lt;/ng-content&gt;</code></li>
<li>possible scenarios: display dynamic contents / as a component container</li>
</ul>
<p>For example:</p>
<pre><code>&lt;ng-content select=&quot;span&quot;&gt;&lt;&#x2F;ng-content&gt;
&lt;ng-content select=&quot;.special&quot;&gt;&lt;&#x2F;ng-content&gt; &lt;!-- special is class name --&gt;
&lt;ng-content select=&quot;[appGridItem]&quot;&gt;&lt;&#x2F;ng-content&gt;</code></pre>

<h4 id="2-Router"><a href="#2-Router" class="headerlink" title="2. Router"></a><font color="dodgerblue">2. Router</font></h4><p>The most important benefit <em>Router</em> brings to us is that it helps decouple independent components. Its definition includes:</p>
<ul>
<li>path</li>
<li>component</li>
<li>child router</li>
</ul>
<p>And to use it, we need to import <code>RouterModule</code> both <code>forRoot</code> and <code>forChild</code>. For example,<br><img src="router.png" width="80%" height="70%"><br>Next, we will see how to use <em>Router</em> in detail.</p>
<p><font color="mediumslateblue"><strong>Practice 1: Router to Home Page</strong></font></p>
<ul>
<li>First, create a file <code>app-routing.module.ts</code>. Use directive <code>ng-router-appmodule</code> generating a router template. Then add a <em>route</em>.</li>
</ul>
<pre><code>import { NgModule } from &#39;@angular&#x2F;core&#39;;
import { RouterModule, Routes } from &#39;@angular&#x2F;router&#39;;
import { HomeContainerComponent } from &#39;.&#x2F;home&#39;;

const routes: Routes = [
  { path: &#39;&#39;, component: HomeContainerComponent }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule {}</code></pre>

<p>In <code>app.component.html</code> add a tag <code>&lt;router-outlet&gt;&lt;/router-outlet&gt;</code>. Then, don’t forget to import <code>AppRoutingModule</code> and <code>HomeModule</code> in <code>app.module.ts</code>.</p>
<p><font color="mediumslateblue"><strong>Practice 2: Child Router in Home Page</strong></font></p>
<p>We create a child router in the home page as follows. In file <code>home-routing.module.ts</code>,</p>
<pre><code>const routes: Routes = [
  {
    path: &#39;home&#39;,
    component: HomeContainerComponent,
    children: [
      {
        path: &#39;&#39;,
        redirectTo: &#39;hot&#39;,
        pathMatch: &#39;full&#39;
      },
      {
        path: &#39;:tabLink&#39;, 
        component: HomeDetailComponent
      }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})</code></pre>

<p><font color="mediumslateblue"><strong>Practice 3: Params in Router URL</strong></font></p>
<ul>
<li><strong>Configuration</strong><pre><code>{ path: &#39;:tabLink&#39;, component: HomeDetailComponent }</code></pre></li>
<li><strong>Activation</strong>: Two types<pre><code>&lt;!-- params --&gt;
&lt;a [routerLink=&quot;[&#39;&#x2F;home&#39;, tab.link]&quot;]&gt;...&lt;&#x2F;a&gt;
&lt;a [routerLink=&quot;[&#39;&#x2F;home&#39;, tab.link, {name: &#39;val1&#39;}]&quot;]&gt;&lt;&#x2F;a&gt;
&lt;!-- query params --&gt;
&lt;a [routerLink=&quot;[&#39;&#x2F;home&#39;, tab.link, [queryParams]={name: &#39;val1&#39;}]&quot;]&gt;&lt;&#x2F;a&gt;
&lt;!-- add style for activated router link --&gt;
&lt;!-- class name: active --&gt;
&lt;a [routerLink]=&quot;[ &#39;grand&#39; ]&quot; routerLinkActive=&quot;active&quot;
   [queryParams]=&quot;{name: &#39;tonny&#39;, gender: &#39;girl&#39;}&quot;
   &gt;...&lt;&#x2F;a&gt;
this.router.navigate([&#39;home&#39;, tab.link]);
this.router.navigate([&#39;home&#39;, tab.link, {queryParams: {name: &#39;val1&#39;}}]);</code></pre></li>
<li>Corresponding <strong>URL</strong> is like <ul>
<li><code>http://localhost:4200/home/sports</code></li>
<li><code>http://localhost:4200/home/sports;name=val1</code></li>
<li><code>http://localhost:4200/home/sports?name=val1</code></li>
</ul>
</li>
<li><strong>Read Params in URL</strong><pre><code>this.route.paramsMap.subscribe(param =&gt; {...});
this.route.queryParamsMap.subscribe(param =&gt; {...});</code></pre>

</li>
</ul>
<h4 id="3-Pipe"><a href="#3-Pipe" class="headerlink" title="3. Pipe"></a><font color="dodgerblue">3. Pipe</font></h4><p>Pipe can help transform values in the <em>View</em>. For example, <code>1234</code> -&gt; <code>$ 1234</code>. The following image shows <em>pipes</em> provided by Angular.</p>
<img src="pipes.png" width="80%" height="85%">

<p>How to use it ? Using <code>|</code>, e.g.</p>
<pre><code>&lt;p&gt; {\{ obj | json }} &lt;&#x2F;p&gt;
&lt;p&gt; {\{ date | date: &#39;MM-dd&#39; }} &lt;&#x2F;p&gt;
&lt;p&gt; {\{ date | date: &#39;yyyy-MM-dd&#39; }} &lt;&#x2F;p&gt;
&lt;p&gt; {\{ price | currency }} &lt;&#x2F;p&gt;
&lt;p&gt; {\{ price | currency: &#39;CNY&#39; }} &lt;&#x2F;p&gt;
&lt;p&gt; {\{ price | currency: &#39;CNY&#39;: &#39;symbol&#39;: &#39;4.0-2&#39; }} &lt;&#x2F;p&gt;
&lt;!-- data = [1, 2, 3, 4, 5] --&gt;
&lt;!-- output is [2, 3] --&gt;
&lt;!-- slice: left: right (left close, right open) --&gt;
&lt;p&gt; {\{ data | slice: 1:3 }} &lt;&#x2F;p&gt; </code></pre>

<p><font color="mediumslateblue"><strong>Practice: customized <em>pipe</em></strong></font></p>
<p>We can also create our customized <em>pipe</em>. In the following example, we create an <em>ago-pipe</em>, which returns <code>... units ago</code>. First, use <code>ng-pipe</code> generating the pipe template.</p>
<pre><code>import { Pipe, PipeTransform } from &#39;@angular&#x2F;core&#39;;

@Pipe({name: &#39;appAgo&#39;})
export class AgoPipe implements PipeTransform {
  transform(value: any): any {
    if (value) {
      const seconds = Math.floor((+new Date - +new Date(value)) &#x2F; 1000);
      if (seconds &lt; 30) {
        return &#39;A few seconds ago&#39;;
      }

      const intervals = {
        years: 3600 * 24 * 365,
        months: 3600 * 24 * 30,
        weeks: 3600 * 24 * 7,
        days: 3600 * 24,
        hours: 3600,
        minutes: 60,
        secondes: 1
      };

      let counter = 0;
      for (const unitName in intervals) {
        if (intervals.hasOwnProperty(unitName)) {
          const unitValue = intervals[unitName];  
          counter = Math.floor(seconds &#x2F; unitValue);
          if (counter &gt; 0) {
            return `${counter} ${unitName} ago`;
          }           
        }
      }
    }

    return value;
  }
}</code></pre>

<p>Then we can use the created <code>ago-pipe</code>.</p>
<pre><code>&lt;!-- html file --&gt;
&lt;p&gt; {\{ date | agoPipe }} &lt;&#x2F;p&gt;</code></pre>

<pre><code>&lt;!-- according ts file --&gt;
export class HomeGrandComponent implements OnInit {
  date: Date;

  constructor() { }
  
  ngOnInit() {
    this.date = this.minusDays(new Date(), 60);
  }

  minusDays(date: Date, days: number) {
    const result = new Date(date);
    result.setDate(result.getDate() - days);
    return result;
  }

}</code></pre>

<p>Then we can see 2 months ago in the <em>view</em>.</p>
<h4 id="4-Dependency-Injection"><a href="#4-Dependency-Injection" class="headerlink" title="4. Dependency Injection"></a><font color="dodgerblue">4. Dependency Injection</font></h4><p>The procedure of how to use <em>DI</em> is shown as follows.<br><img src="DI.png" width="80%" height="80%"><br>The instance created through <em>DI</em> is singleton. Say if component A and component B both inject a service, they are acturally using the same instance.</p>
<p>In angular, if we want to make some class injectable, we just need to add decorator <code>@Injectable()</code> above that class. For example,</p>
<pre><code>@Injectable
class Product {
  constructor(private name: string, private color: string) {}
  &#x2F;&#x2F; the above line combine the field declaration and constructor together.
}

@Injectable
class PurchaseOrder {
  private amount: number;
  constructor(private product: Product) {}
}</code></pre>

<p>Then declare the <em>injectable</em> class / factory using <code>Injector.create();</code> as follows.</p>
<pre><code>export class HomeGrandComponent implements OnInit {
  &#x2F;&#x2F; some codes
  ngOninit() {
    const injector = Injector.create({
      providers: [
        {
          provider: Product,
          &#x2F;&#x2F;useClass: Product &#x2F;&#x2F; inject a class
          &#x2F;&#x2F; or we can directly inject a specific object using useFactory
          useFactory: () =&gt; {
            return new Product(&quot;molten edge&quot;, &quot;golden&quot;)
          },
          deps: [] &#x2F;&#x2F; the dependencies of this provider
        },
        {
          provider: PurchaseOrder,
          useCass: PurchaseOrder,
          deps: [Product]
        }
      ]
    });

    console.log(injector.get(Product));
    console.log(injector.get(PurchaseOrder));
  }
}</code></pre>

<p>Then we can get the following results in the console.<br><img src="console1.png" width="70%" height="70%"></p>
<p><font color="mediumslateblue"><strong>Practice 1: home service</strong></font></p>
<p>It’s better to create serives for each module to do the data transfer job. Say we want to decouple <em>data</em> and <em>components</em>. <em>DI</em> provides a great way to do this. Next we will create a home service and see how to use <em>DI</em> to decouple <em>data</em> and our components.<br>First, use <code>ng-service</code> to generate a service template. In this service, we put our data.</p>
<pre><code>import { Injectable } from &#39;@angular&#x2F;core&#39;;
import { TopMenu, ImageSlider, Channel } from &#39;src&#x2F;app&#x2F;shared&#x2F;components&#39;;

@Injectable()
export class HomeService {
  menus: TopMenu[] = [...];

  imageSliders: ImageSlider[] = [...];
  
  getTabs() { return this.menus; }

  getBanners() { return this.imageSliders; }

  getChannels() { return this.channels; }
}</code></pre>

<p>Future, we will get these data throug HTTP.</p>
<p><font color="tomato">To use this service, <strong>don’t forget</strong> to declare this service in <code>.module.ts</code>.</font></p>
<pre><code>@NgModule({
  declarations: [...],
  providers: [
    HomeService
  ],
  imports: [...]
})</code></pre>

<p>Now we can employ <em>DI</em> to get the data.</p>
<pre><code>topMenus: TopMenu[]: [];
constructor(private service: HomeService) {}
ngOnInit() { this.topMenus = this.service.getTabs(); }</code></pre>

<p><font color="mediumslateblue"><strong>Practice 2: transfer a string value</strong></font></p>
<p>We can also just transfer a value using <em>DI</em>.</p>
<pre><code>ngOnInit() {
  const injector = new Injector.create({
    providers: [{
      {
        provider: &#39;baseUrl&#39;,
        useValue: &#39;http:&#x2F;&#x2F;localhost&#39;
      }
    }]
  })	
}</code></pre>

<p>We can use a string <code>&#39;baseUrl&#39;</code> to be the indicator of a injectable value, however in large project this may cause conflict. So Angular wants us to use <em>Token</em> as the string type indicator.</p>
<pre><code>ngOnInit() {
  const token = new InjectionToken&lt;string&gt;(&#39;baseUrl&#39;);
  const injector = new Injector.create({
    providers: [{
      {
        provide: token,
        useValue: &#39;http:&#x2F;&#x2F;localhost&#39;
      }
    }]
  })	
}</code></pre>

<p><strong>How to transfer a string to other components?</strong> </p>
<ul>
<li>First export it and also do the declaration in <code>.module.ts</code>.<pre><code>export const token = new InjectionToken&lt;string&gt;(&#39;baseUrl&#39;);</code></pre>

</li>
</ul>
<pre><code>providers: [HomeService, { provide: token, useValue: &#39;http:&#x2F;&#x2F;localhost&#39; }]</code></pre>

<ul>
<li>Then we can use it as follows.</li>
</ul>
<pre><code>constructor(
  @Inject(token) private baseUrl: string
) { }</code></pre>

<h4 id="5-Validation"><a href="#5-Validation" class="headerlink" title="5. Validation"></a><font color="dodgerblue">5. Validation</font></h4><ul>
<li><font color="PALEVIOLETRED"><strong>What?</strong></font> <em>view</em> is refreshed when the data is changed.</li>
<li><font color="DARKORANGE"><strong>When?</strong></font> when validation is triggered?<ul>
<li>browser events (e.g. click, mouseover, keyup,… )</li>
<li><code>setTimeout()</code> and <code>setInterval()</code></li>
<li><code>HTTP</code> request</li>
</ul>
</li>
<li><font color="YELLOWGREEN"><strong>How?</strong></font> Compare current status and new status. </li>
</ul>
<p><font color="tomato"> The validation procedure is synchronous. And it is done twice by Angular framework.</font></p>
<img src="validation.png" width="80%" height="80%">

<p>As the above pic shows <font color="tomato">validation procedure is done <strong>before</strong> <code>AfterViewChecked</code> and <code>AfterViewInit</code> hook, so we should change property values in functions <code>ngAfterViewChecked()</code> and <code>ngAfterViewInit()</code>.</font> For example, the following code will cause <font color="red">Error</font>.</p>
<pre><code>&lt;span [textContent]=&quot;time | HH:mm:ss:SSS&quot;&gt;&lt;&#x2F;span&gt;
&lt;!-- or &lt;span&gt;&lt;&#x2F;span&gt; --&gt;</code></pre>

<pre><code>public get time(): number {
  return this.\_time;
}

ngAfterViewChecked(): void {
  this.\_title = &#39;hello&#39;;
}</code></pre>

<p>How to solve this problem? We can use <strong>NgZone</strong>, set the change to be outside Angular.</p>
<pre><code>\_time;
public get time(): number {
  return this.\_time;
}

constructor(private ngZone: NgZone) {}

ngAfterViewChecked(): void {
  this.ngZone.runOutsideAngular(() =&gt; {
    setInterval( () =&gt; {
      this.\_time = Date.now();
    }, 200);
  });
}</code></pre>

<p>Then add a button to trigger <em>Validation</em>.</p>
<p>The above code still has limitation. We can not read time continuously. If we want to view the change in every millisecond, we’d better not use <em>binding</em>. Instead, operating <em>DOM</em> element is an effecient solution.</p>
<pre><code>&lt;span #timeRef&gt;&lt;&#x2F;span&gt;</code></pre>

<pre><code>@ViewChild(&#39;timeRef&#39;) timeRef: ElementRef;
ngAfterViewChecked(): void {
  setInterval( () =&gt; {
    this.timeRef.nativeElement.innerText = Date.now();
  } , 200);
}</code></pre>

<p>Operating <em>DOM</em> element directly is not recommended. Instead, we can use <code>Renderer2</code>.</p>
<pre><code>constructor(private rd2: Renderer2) {}
@ViewChild(&#39;timeRef&#39;) timeRef: ElementRef;
ngAfterViewChecked(): void {
  setInterval( () =&gt; {
    this.rd2.setProperty(this.timeRef.nativeElement, 
    &#39;innerText&#39;, 
    Date.now());
  } , 200);
}</code></pre>

<p>We can also pipes in class to format Date.</p>
<pre><code>constructor(private rd2: Renderer2) {}
@ViewChild(&#39;timeRef&#39;) timeRef: ElementRef;
ngAfterViewChecked(): void {
  setInterval( () =&gt; {
    this.rd2.setProperty(this.timeRef.nativeElement, 
    &#39;innerText&#39;, 
    formatDate(Date.now(), HH:mm:ss:SSS), &#39;zh-Hans&#39;);
  } , 200);
}</code></pre>


            </div>
            <hr>

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>Reprint policy</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
                    <img alt style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png">
                </a>
            </div>
            <br>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">
                    《Project - Groupbuy App Part IV》
                </span> by
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2019/06/26/angular-projectIV/" property="cc:attributionName" rel="cc:attributionURL">
                Tong Shi
            </a> is licensed under a
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
                Creative Commons Attribution 4.0 International License
            </a> 
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2019/06/27/leetcodeQ927/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="Three Equal Parts">
                        
                        <span class="card-title">Three Equal Parts</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            LeetCode Q 927 -  Three Equal PartsGiven an array A of 0s and 1s, divide the array into 3 non-empty parts such that all 
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-06-27
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-user fa-fw"></i>
                            Tong Shi
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/LeetCode/" target="_blank">
                        <span class="chip bg-color">LeetCode</span>
                    </a>
                    
                    <a href="/tags/Math/" target="_blank">
                        <span class="chip bg-color">Math</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2019/06/26/leetcodeQ1037/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="Valid Boomerang">
                        
                        <span class="card-title">Valid Boomerang</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            LeetCode Q 1037 -  Valid BoomerangA boomerang is a set of 3 points that are all distinct and not in a straight line.Give
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-06-26
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-user fa-fw"></i>
                            Tong Shi
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/LeetCode/" target="_blank">
                        <span class="chip bg-color">LeetCode</span>
                    </a>
                    
                    <a href="/tags/Math/" target="_blank">
                        <span class="chip bg-color">Math</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Tong Shi&nbsp;@
            <a href="https://hexo.io/" target="_blank">Hexo</a>&nbsp;
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>&nbsp;
            <br>
            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;Total Words:&nbsp;<span class="white-color">169.5k</span>&nbsp;
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="fa fa-eye"></i>&nbsp;Total visits:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fa fa-users"></i>&nbsp;Total visitors:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;
            </span>
            
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/tongshi049" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:tshi3@ualberta.ca" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword" class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140095224-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-140095224-1');
</script>



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>